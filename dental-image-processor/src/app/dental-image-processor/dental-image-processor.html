<div class="dental-image-processor">
  <div class="header">
    <h2>Xá»­ lÃ½ áº£nh nha khoa</h2>
    <p class="instruction">Click vÃ o cÃ¡c vÃ¹ng rÄƒng (bounding box) Ä‘á»ƒ Ä‘Ã¡nh dáº¥u báº±ng dáº¥u X mÃ u Ä‘á»</p>
  </div>

  <!-- Input Ä‘á»ƒ load áº£nh base64 -->
  <div class="image-input-section">
    <h3>Load áº£nh tá»« Base64</h3>
    <div class="input-group">
      <textarea 
        #base64Input
        class="base64-input" 
        placeholder="Paste chuá»—i base64 cá»§a áº£nh vÃ o Ä‘Ã¢y (báº¯t Ä‘áº§u vá»›i data:image/...)"
        rows="3">
      </textarea>
      <button 
        class="btn btn-primary" 
        (click)="loadImageFromInput(base64Input.value)">
        Load áº£nh
      </button>
    </div>
  </div>

  <div class="main-content">
    <!-- Canvas chÃ­nh Ä‘á»ƒ hiá»ƒn thá»‹ vÃ  xá»­ lÃ½ áº£nh -->
    <div class="canvas-container">
      <h3>áº¢nh gá»‘c vá»›i bounding boxes</h3>
      <canvas 
        #canvas 
        class="main-canvas"
        [style.cursor]="'crosshair'">
      </canvas>
      
      <div class="canvas-info">
        <p><strong>HÆ°á»›ng dáº«n:</strong></p>
        <ul>
          <li>Click vÃ o vÃ¹ng rÄƒng (khung xanh) Ä‘á»ƒ Ä‘Ã¡nh dáº¥u</li>
          <li>Click láº¡i Ä‘á»ƒ bá» Ä‘Ã¡nh dáº¥u</li>
          <li>Chá»‰ cÃ³ thá»ƒ click trong vÃ¹ng bounding box</li>
        </ul>
      </div>
    </div>

    <!-- ThÃ´ng tin vÃ  Ä‘iá»u khiá»ƒn -->
    <div class="controls-container">
      <div class="marked-teeth-info">
        <h4>RÄƒng Ä‘Ã£ Ä‘Ã¡nh dáº¥u:</h4>
        <div class="marked-list">
          <span 
            *ngFor="let toothId of getMarkedTeethIds()" 
            class="marked-tooth-badge">
            RÄƒng {{ toothId }}
          </span>
          <span *ngIf="getMarkedTeethIds().length === 0" class="no-marks">
            ChÆ°a cÃ³ rÄƒng nÃ o Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u
          </span>
        </div>
      </div>

      <div class="action-buttons">
        <button 
          class="btn btn-primary" 
          (click)="saveImage()"
          [disabled]="markedTeeth.length === 0">
          <i class="icon-save"></i>
          LÆ°u áº£nh
        </button>
        
        <button 
          class="btn btn-secondary" 
          (click)="clearMarks()"
          [disabled]="markedTeeth.length === 0">
          <i class="icon-clear"></i>
          XÃ³a táº¥t cáº£ dáº¥u X
        </button>
        
        <button 
          class="btn btn-success" 
          (click)="downloadImage()"
          [disabled]="!savedImageBase64">
          <i class="icon-download"></i>
          Táº£i xuá»‘ng
        </button>
        
        <button class="btn btn-info" (click)="forceRedraw()">
          ğŸ”„ Váº½ láº¡i
        </button>
        
        <button class="btn btn-warning" (click)="checkStatus()">
          ğŸ” Kiá»ƒm tra
        </button>
      </div>
    </div>
  </div>

  <!-- Preview áº£nh Ä‘Ã£ lÆ°u -->
  <div class="preview-section" *ngIf="savedImageBase64">
    <h3>Preview áº£nh Ä‘Ã£ lÆ°u</h3>
    <div class="preview-container">
      <canvas #previewCanvas class="preview-canvas"></canvas>
      <div class="preview-info">
        <p><strong>Base64 Ä‘Ã£ táº¡o:</strong></p>
        <textarea 
          class="base64-output" 
          [value]="savedImageBase64" 
          readonly
          placeholder="Base64 sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y sau khi lÆ°u áº£nh">
        </textarea>
        <small class="text-muted">
          Báº¡n cÃ³ thá»ƒ copy base64 nÃ y Ä‘á»ƒ lÆ°u vÃ o backend
        </small>
      </div>
    </div>
  </div>

  <!-- ThÃ´ng tin debug (cÃ³ thá»ƒ áº©n trong production) -->
  <div class="debug-info" *ngIf="false">
    <h4>Debug Information:</h4>
    <div class="debug-content">
      <p><strong>Sá»‘ bounding boxes:</strong> {{ boundingBoxes.length }}</p>
      <p><strong>Sá»‘ rÄƒng Ä‘Ã£ Ä‘Ã¡nh dáº¥u:</strong> {{ markedTeeth.length }}</p>
      <p><strong>Canvas size:</strong> {{ canvasWidth }} x {{ canvasHeight }}</p>
    </div>
  </div>
</div>
